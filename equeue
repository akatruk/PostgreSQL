{
mkdir -p /var/lib/pgsql
cd /var/lib/pgsql
mkdir -p test/equeue/data
mkdir -p test/equeue/conf
mkdir -p test/equeue/wal_archive
chown -R postgres:postgres test
ls -ld /var/lib/pgsql/test/equeue/data
ls -ld /var/lib/pgsql/test/equeue/conf
ls -ld /var/lib/pgsql/test/equeue/wal_archive
}


rpm -Uvh https://yum.postgresql.org/11/redhat/rhel-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm

yum -y install https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7-x86_64/pgdg-centos11.noarch.rpm
yum list |egrep -i "postgresql11|postgresql11-server|postgresql11-contrib|postgresql11-libs"
<list packages>

yum -y remove postgresql11 postgresql11-server postgresql11-contrib postgresql11-libs

yum -y install postgresql11 postgresql11-server postgresql11-contrib postgresql11-libs
<Complete!>

3. Установка
/usr/pgsql-11/bin/initdb -D /var/lib/pgsql/test/equeue/data
/usr/pgsql-11/bin/pg_ctl -D /var/lib/pgsql/test/equeue/data -l logfile start



as root@postgres1s:

{
cat /lib/systemd/system/postgresql-11.service > /usr/lib/systemd/system/postgresql11_equeue.service
sed -i 's/Environment=PGDATA=\/var\/lib\/pgsql\/11\/data\//Environment=PGDATA=\/var\/lib\/pgsql\/test\/equeue\/conf\//' /usr/lib/systemd/system/postgresql11_equeue.service
sed -i 's/ExecStartPre=\/usr\/pgsql-11\/bin\/postgresql-11-check-db-dir \${PGDATA}/ExecStartPre=\/usr\/pgsql-11\/bin\/postgresql-11-check-db-dir \/var\/lib\/pgsql\/test\/equeue\/data\//' /usr/lib/systemd/system/postgresql11_equeue.service
echo "Environment=PGPORT=5432" >> /usr/lib/systemd/system/postgresql11_equeue.service
mv /var/lib/pgsql/test/equeue/data/pg_hba.conf /var/lib/pgsql/test/equeue/conf/pg_hba.conf
mv /var/lib/pgsql/test/equeue/data/pg_ident.conf /var/lib/pgsql/test/equeue/conf/pg_ident.conf 
mv /var/lib/pgsql/test/equeue/data/postgresql.conf /var/lib/pgsql/test/equeue/conf/postgresql.conf
}

as postgres@<server>:
{
CONF_FILE=/var/lib/pgsql/test/equeue/conf/postgresql.conf
PG_HBA=/var/lib/pgsql/test/equeue/conf/pg_hba.conf
echo "data_directory = '/var/lib/pgsql/test/equeue/data/'
max_connections = 300
shared_buffers = 8GB
effective_cache_size = 24GB
maintenance_work_mem = 2GB
checkpoint_completion_target = 0.7
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 13981kB
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
listen_addresses = '*'
wal_level = replica
fsync = on
wal_sync_method = fdatasync
full_page_writes = on
max_wal_senders = 10
wal_keep_segments = 100
max_replication_slots = 10
#hot_standby = on
#archive_mode = on
archive_command = 'test ! -f /var/lib/pgsql/test/equeue/wal_archive/%f && cp %p /var/lib/pgsql/test/equeue/wal_archive/%f'

min_wal_size = 1GB
max_wal_size = 2GB
checkpoint_timeout='30min'

####vacuuming####
autovacuum = on
autovacuum_analyze_scale_factor = 0.05
autovacuum_analyze_threshold = 50
autovacuum_max_workers = 10
autovacuum_naptime = 60
autovacuum_vacuum_cost_delay = 20
autovacuum_vacuum_cost_limit = -1
autovacuum_vacuum_scale_factor = 0.01
autovacuum_vacuum_threshold = 50
vacuum_cost_limit = 1000

####logging####
log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y%m%d_%H%M.log'
log_rotation_age = 360
#log_min_duration_statement = 0
log_checkpoints = on
#log_connections = on
#log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0
log_error_verbosity = default
#log_duration = on" >> $CONF_FILE
echo "host all all 0.0.0.0/0 md5
host all all 127.0.0.1/32 trust" >> $PG_HBA
echo "export PATH=/usr/pgsql-11/bin:\$PATH" >> $HOME/.bash_profile
}



{
systemctl enable postgresql11_equeue.service
systemctl restart postgresql11_equeue.service
ps -ef |egrep "postg|pgbo"
}

rsync -a /var/lib/pgsql/test/equeue/ postgres@10.220.12.79:/var/lib/pgsql/test/equeue/ --exclude postmaster.pid

passwd postgres
GNBRJ#oelmv4221@@