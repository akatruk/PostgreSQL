useradd postgres -s /bin/bash -d /home/postgres/ -m
passwd postgres
test123!@#Test

{
mkdir -p /var/lib/pgsql
cd /var/lib/pgsql
mkdir -p test/project/data
chown -R postgres:postgres test
}

apt -y install postgresql postgresql-contrib

3. Установка (as postgres)

/usr/lib/postgresql/10/bin/initdb -D /var/lib/pgsql/test/project/data
/usr/lib/postgresql/10/bin/pg_ctl -D /var/lib/pgsql/test/project/data -l logfile start


Добавили в .bash_profile:


as postgres@10.80.134.24:
{
CONF_FILE=/var/lib/pgsql/test/project/data/postgresql.conf
PG_HBA=/var/lib/pgsql/test/project/data/pg_hba.conf
echo "data_directory = '/var/lib/pgsql/test/project/data/'
max_connections = 20
shared_buffers = 128MB
effective_cache_size = 384MB
maintenance_work_mem = 32MB
checkpoint_completion_target = 0.7
wal_buffers = 3932kB
default_statistics_target = 110
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 3276kB
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
listen_addresses = '*'
wal_level = replica
fsync = on
wal_sync_method = fdatasync
full_page_writes = on
max_wal_senders = 11
wal_keep_segments = 110
max_replication_slots = 11
#hot_standby = on
archive_mode = on
archive_command = 'test ! -f /var/lib/pgsql/test/project/data/wal_archive/%f && cp %p /var/lib/pgsql/test/project/data/wal_archive/%f'

min_wal_size = 1GB
max_wal_size = 2GB
checkpoint_timeout='30min'

####vacuuming####
autovacuum = on
autovacuum_analyze_scale_factor = 0.05
autovacuum_analyze_threshold = 50
autovacuum_max_workers = 11
autovacuum_naptime = 60
autovacuum_vacuum_cost_delay = 20
autovacuum_vacuum_cost_limit = -1
autovacuum_vacuum_scale_factor = 0.01
autovacuum_vacuum_threshold = 50
vacuum_cost_limit = 1100

####logging####
log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y%m%d_%H%M.log'
log_rotation_age = 360
log_min_duration_statement = 0
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0
log_error_verbosity = default
#log_duration = on" >> $CONF_FILE
echo "host all all 192.168.56.0/32 md5
host all all 127.0.0.1/32 trust" >> $PG_HBA
echo "export PATH=/usr/pgsql-11/bin:\$PATH" >> $HOME/.bash_profile
}


ps -ef |egrep "postg|pgbo"

{
systemctl restart postgresql11_project.service
systemctl enable postgresql11_project.service
ps -ef |egrep "postg|pgbo"
}

pgbadger


{
CONF_FILE=/var/lib/pgsql/test/project/data/postgresql.conf
PG_HBA=/var/lib/pgsql/test/project/data/pg_hba.conf
echo "data_directory = '/var/lib/pgsql/test/project/data/'
log_line_prefix = '%t [%p]: [%l-1] '
log_statement = 'none'
log_min_duration_statement = 0
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0
logging_collector = on
log_directory = '/var/log/postgresquerylog/'
log_filename = 'postgresql.log'
log_destination = 'csvlog,stderr'
}