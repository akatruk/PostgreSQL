https://github.com/postgrespro/pg_wait_sampling

as root:

chown -R postgres:postgres /usr/pgsql-11/
yum -y install git postgresql11-devel gcc centos-release-scl libicu-devel
yum -y install devtoolset-7
yum -y install llvm-toolset-7
mkdir -p /usr/lib64/llvm5.0
mkdir -p /usr/lib64/llvm5.0/bin
cd /usr/lib64/llvm5.0/bin
ln -s /opt/rh/llvm-toolset-7/root/usr/bin/llvm-lto
chown -R postgres:postgres /usr/pgsql-11
chmod 755 -R /usr/pgsql-11


as postgres:

git clone https://github.com/postgrespro/pg_wait_sampling.git
cd pg_wait_sampling
source /home/postgres/.bash_profile
make USE_PGXS=1
sudo make USE_PGXS=1 install
make USE_PGXS=1 installcheck
psql postgres -c "CREATE EXTENSION pg_wait_sampling;"
psql postgres -c "alter system set shared_preload_libraries = 'pg_wait_sampling';"

chown -R postgres:postgres /usr/pgsql-11/

https://github.com/postgrespro/pg_wait_sampling/commit/34e9e4774705b41f0f193b9603ce2d053fddc49e


----------------------------------------------------------------
add profile /home/postgres/.bash_profile

as root:

yum -y install postgresql11-devel git gcc centos-release-scl postgresql11 postgresql11-server postgresql11-contrib postgresql11-libs devtoolset-7 llvm-toolset-7
yum -y install devtoolset-7
yum -y install llvm-toolset-7
git clone https://github.com/postgrespro/pg_wait_sampling.git
cd pg_wait_sampling
source /home/postgres/.bash_profile
make USE_PGXS=1
mkdir -p /usr/lib64/llvm5.0
mkdir -p /usr/lib64/llvm5.0/bin
cd /usr/lib64/llvm5.0/bin
ln -s /opt/rh/llvm-toolset-7/root/usr/bin/llvm-lto

as postgres:
psql postgres -c "CREATE EXTENSION pg_wait_sampling;"
psql postgres -c "alter system set shared_preload_libraries = 'pg_wait_sampling';"



